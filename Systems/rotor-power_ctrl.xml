<?xml version="1.0"?>

<system name="rotor">

 <!-- <property value="1.0">systems/rotor/clutch-cmd</property>-->





  <!-- Clutch ********************************************** -->

  <channel name="clutch">
      
      <switch name="systems/rotor/clutch-cmd">
          <default value="systems/rotor/clutch-cmd-norm"/>
          <test logic="AND" value="1">
	      propulsion/engine[0]/engine-rpm GT 100
	      propulsion/engine[0]/n1 GT 20
          </test>
          <output>systems/rotor/clutch-cmd-norm</output>
      </switch>
      

   <kinematic name="clutch control">
     <input>systems/rotor/clutch-cmd</input>
     <traverse>
       <setting>
          <position> 0 </position>
          <time>     0 </time>
       </setting>
       <setting>
          <position> 1 </position>
          <time>     20 </time>
       </setting>
     </traverse>
     <output>propulsion/engine[0]/clutch-ctrl-norm</output>
     <output>propulsion/engine[1]/clutch-ctrl-norm</output>
   </kinematic>

  </channel>

  <!-- Brake *********************************************** -->

   <property value="1">animation/rotor_brake-switch-lock-cmd</property>
  <property value="1">animation/rotor_brake-switch-cmd</property>
  <property value="0">fcs/blade-fold-pos-norm</property>


  <channel name="brake">
      
      
       <switch name="animation/rotor_brake-switch-lock">
          <default value="0"/>
          <test logic="OR" value="1">
              animation/rotor_brake-switch-lock-cmd == 1
	      fcs/blade-fold-pos-norm != 0
          </test>
      </switch>

      <switch name="systems/rotor/rotor_brake-switch">
          <default value="0"/>
          <test logic="AND" value="1">
              animation/rotor_brake-switch-lock  == 1
              animation/rotor_brake-switch-cmd == 1
          </test>
	  <test logic="OR" value="1">
	      systems/sinking/propulsion == 0
          </test>
          <output>animation/rotor_brake-switch-cmd</output>
      </switch>
      
      <kinematic name="systems/rotor/brake-cmd">
          <input>systems/rotor/rotor_brake-switch</input>
          <traverse>
              <setting>
                  <position>0</position>
                  <time>0</time>
              </setting>
              <setting>
                  <position>1</position>
                  <time>0.5</time>
              </setting>
          </traverse>
              <output>systems/rotor/brake-cmd-norm</output>
      </kinematic>

      <switch name="systems/rotor/brake-cmd-norm-tr">
          <default value="systems/rotor/brake-cmd-norm"/>
          <test logic="AND" value="0.8">
              propulsion/engine[0]/rotor-rpm  LE 35
              propulsion/engine[0]/rotor-rpm  GE 3
              systems/rotor/brake-cmd-norm == 1
          </test>
    </switch>

   <kinematic name="brake control">
     <input>systems/rotor/brake-cmd-norm-tr</input>
     <traverse>
       <setting>
          <position> 0 </position>
          <time>     0 </time>
       </setting>
       <setting>
          <position> 1 </position>
          <time>     5 </time>
       </setting>
     </traverse>
     <output>propulsion/engine[0]/brake-ctrl-norm</output>
     <output>propulsion/engine[1]/brake-ctrl-norm</output>
   </kinematic>

  </channel>


  <!-- Collective ******************************************* -->

  <channel name="collective">
    <!-- map throttle axis to collective -->
      <fcs_function name="map">
        <function>
           <table>
             <independentVar>fcs/throttle-cmd-norm</independentVar>
             <tableData>
                  0   1
                  1   0
             </tableData>
           </table>
        </function>
        <output>systems/rotor/collective-cmd-norm</output>
      </fcs_function>
      <lag_filter name="fcs/collective-lag">
        <input> systems/rotor/collective-cmd-norm </input>
        <c1>    5.0 </c1>
      </lag_filter>
      <pure_gain name="fcs/collective-gain">
        <input>  fcs/collective-lag </input>
        <gain>   0.23038346</gain> <!--13.2 deg-->
        <output> fcs/x-col </output>
      </pure_gain>
      <summer name="fcs/collective-ctrl-rad">
        <input> fcs/x-col </input>
        <input> ap/collective-cmd </input>
        <bias> 0.06981317 </bias> 4 deg
        <clipto>
          <min> 0.0 </min>
          <max> 0.7 </max>
        </clipto>
        <output> propulsion/engine/collective-ctrl-rad </output>
      </summer>
    </channel>


</system>
