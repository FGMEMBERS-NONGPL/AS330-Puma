<?xml version="1.0"?>
<!--
    usable with flightgear or JSBSim stand-alone
    COPYRIGHT gerard robin  23-03-2010




-->

<system name="Instruments">

<property value="0">instruments/autopilot-AFCS</property>

<channel name="radar-altitude">


    <fcs_function name="instruments/agl-under_wheel">
        <function>
            <difference>
                <property>position/h-agl-ft</property>
                <value>5.60</value>
            </difference>
        </function>
    </fcs_function>

</channel>

<channel name="Engines Active">

    <switch name="instruments/left-engine-active">
        <default value="0"/>
	<test logic="OR" value="1">
	    systems/engine/left-engine == 1
	</test>
    </switch>
    
    <switch name="instruments/right-engine-active">
        <default value="0"/>
	<test logic="OR" value="1">
	    systems/engine/right-engine == 1
	</test>
    </switch>    

</channel>




<channel name="Engines n1">

    <switch name="instruments/left-engine-n1">
        <default value="0"/>
	<test logic="OR" value="propulsion/engine[0]/n1">
	    instruments/left-engine-active == 1
	</test>
    </switch>
    
    <switch name="instruments/right-engine-n1">
        <default value="0"/>
	<test logic="OR" value="propulsion/engine[0]/n1">
	    instruments/right-engine-active == 1
	</test>
    </switch>    

</channel>

<channel name="Engines itt-c">

    <switch name="instruments/left-engine-itt-c">
        <default value="0"/>
	<test logic="OR" value="propulsion/engine[0]/itt-c">
	    instruments/left-engine-active == 1
	</test>
    </switch>
    
    <switch name="instruments/right-engine-itt-c">
        <default value="0"/>
	<test logic="OR" value="propulsion/engine[0]/itt-c">
	    instruments/right-engine-active == 1
	</test>
    </switch>    

</channel>


<channel name="Engines Fuel Flow">

    <switch name="instruments/left-engine-fuel-flow-rate">
        <default value="0"/>
	<test logic="OR" value="propulsion/engine[0]/fuel-flow-rate-gph">
	    instruments/left-engine-active == 1
	</test>
    </switch>
    
    <switch name="instruments/right-engine-fuel-flow-rate">
        <default value="0"/>
	<test logic="OR" value="propulsion/engine[0]/fuel-flow-rate-gph">
	    instruments/right-engine-active == 1
	</test>
    </switch>    

</channel>

<channel name="Engines Oil Pressure">

    <switch name="instruments/left-engine-oil-pressure-psi">
        <default value="0"/>
	<test logic="OR" value="/engines/engine[0]/oil-pressure-psi">
	    instruments/left-engine-active == 1
	</test>
    </switch>
    
    <switch name="instruments/right-engine-oil-pressure-psi">
        <default value="0"/>
	<test logic="OR" value="/engines/engine[0]/oil-pressure-psi">
	    instruments/right-engine-active == 1
	</test>
    </switch>    

</channel>


<channel name="Engines Oil Temperature">

    <switch name="instruments/left-engine-oil-temperature-degf">
        <default value="0"/>
	<test logic="OR" value="/engines/engine[0]/oil-temperature-degf">
	    instruments/left-engine-active == 1
	</test>
    </switch>
    
    <switch name="instruments/right-engine-oil-temperature-degf">
        <default value="0"/>
	<test logic="OR" value="/engines/engine[0]/oil-temperature-degf">
	    instruments/right-engine-active == 1
	</test>
    </switch>    

</channel>




<property>instruments/autopilot-lock-true-heading</property>
<property>instruments/autopilot-lock-heading-bug</property>
<property>instruments/autopilot-lock-altitude</property>
<property>instruments/autopilot-hold</property>

<property>/instrumentation/heading-indicator/heading-marker</property>
<property>/instrumentation/heading-indicator/heading-bug-deg</property>

<property>/autopilot/settings/true-heading-deg</property>
<property>/autopilot/settings/heading-bug-deg</property>
<property>/autopilot/settings/target-altitude-ft</property>

<channel name="autopilot-switch">

     <switch name="instruments/true-heading-switch-ctrl">
         <default value="instruments/autopilot-lock-true-heading"/>
         <test logic="AND" value="0">
             instruments/autopilot-lock-heading-bug == 1
         </test>
         <output>instruments/autopilot-lock-true-heading</output>
     </switch>

     <switch name="instruments/heading-bug-switch-ctrl">
         <default value="instruments/autopilot-lock-heading-bug"/>
         <test logic="AND" value="0">
             instruments/autopilot-lock-true-heading == 1
         </test>
         <output>instruments/autopilot-lock-heading-bug</output>
     </switch>

    <switch name="instruments/autopilot-true-heading-indicator-switch">
        <default value="/autopilot/settings/true-heading-deg"/>
        <test logic="AND" value="/instrumentation/heading-indicator/heading-marker">
            instruments/autopilot-lock-true-heading == 1
        </test>
        <output>instruments/autopilot-true-heading-indicator</output>
        <output>/autopilot/settings/true-heading-deg</output>
     </switch>

     <switch name="instruments/autopilot-heading-bug-indicator-switch">
         <default value="/autopilot/settings/heading-bug-deg"/>
         <test logic="AND" value="/instrumentation/heading-indicator/heading-bug-deg">
             instruments/autopilot-lock-heading-bug == 1
         </test>
         <output>instruments/autopilot-dg-heading-indicator</output>
         <output>/autopilot/settings/heading-bug-deg</output>
     </switch>

     <switch name="instruments/autopilot-altitude-indicator-switch">
         <default value="/autopilot/settings/target-altitude-ft"/>
         <test logic="AND" value="position/h-sl-ft">
             instruments/autopilot-lock-altitude == 0
         </test>
         <test logic="AND" value="instruments/autopilot-altitude-indicator">
             instruments/autopilot-lock-altitude == 1
         </test>
         <output>instruments/autopilot-altitude-indicator</output>
     </switch>



     <switch name="instruments/autopilot-engaged">
         <default value="0"/>
         <test logic="AND" value="1">
            instruments/autopilot-hold == 1
         </test>
     </switch>


     <switch name="instruments/autopilot-target-altitude">
         <default value="/autopilot/settings/target-altitude-ft"/>
         <test logic="AND" value="instruments/autopilot-altitude-indicator">
             instruments/autopilot-engaged == 1
         </test>
         <output>/autopilot/settings/target-altitude-ft</output>
     </switch>

</channel>

<channel name="AI">


        <switch name="instruments/instrument-ignit-cmd">
            <default value="0"/>
            <test  logic="AND" value="30">
                electrical/outputs/instr-ignition-switch  lt 27
            </test>
        </switch>

        <!--Une inertie pour l'instrument lors de son activation electrique -->
       <!-- de repos ver op ou de op vers repos-->

        <kinematic name="instruments/ai/roll-deg-mute">
            <input>instruments/instrument-ignit-cmd</input>
            <traverse>
                <setting>
                    <position>0</position>
                    <time>0</time>
                </setting>
                <setting>
                    <position>30</position>
                    <time>3</time>
                </setting>
            </traverse>
        </kinematic>

        <kinematic name="instruments/ai/pitch-deg-mute">
            <input>instruments/instrument-ignit-cmd</input>
            <traverse>
                <setting>
                    <position>0</position>
                    <time>0</time>
                </setting>
                <setting>
                    <position>30</position>
                    <time>3</time>
                </setting>
            </traverse>
        </kinematic>

        <summer name="instruments/ai/roll-deg-on">
            <input>/orientation/roll-deg</input>
            <input>instruments/ai/roll-deg-mute</input>
        </summer>

        <summer name="instruments/ai/pitch-deg-on">
            <input>instruments/ai/pitch-deg-mute</input>
        </summer>





        <switch name="instruments/ai/roll-deg">
            <default value="instruments/ai/roll-deg-on"/>
            <test  logic="AND" value="instruments/ai/roll-deg-mute">
                instruments/ai/roll-deg-mute gt 1
                electrical/outputs/instr-ignition-switch  lt 27
            </test>
        </switch>

        <switch name="instruments/ai/pitch-deg">
            <default value="instruments/ai/pitch-deg-on"/>
            <test  logic="AND" value="instruments/ai/pitch-deg-mute">
                instruments/ai/pitch-deg-mute gt 1
                electrical/outputs/instr-ignition-switch  lt 27
            </test>
        </switch>
	
	
	</channel>

    <channel name="GSDI">
	
	<kinematic name="instruments/gsdi/drift-u-kt-mute">
            <input>instruments/instrument-ignit-cmd</input>
            <traverse>
                <setting>
                    <position>0</position>
                    <time>0</time>
                </setting>
                <setting>
                    <position>40</position>
                    <time>3</time>
                </setting>
            </traverse>
        </kinematic>

        <kinematic name="instruments/gsdi/drift-v-kt-mute">
            <input>instruments/instrument-ignit-cmd</input>
            <traverse>
                <setting>
                    <position>0</position>
                    <time>0</time>
                </setting>
                <setting>
                    <position>40</position>
                    <time>3</time>
                </setting>
            </traverse>
        </kinematic>
	
	 <summer name="instruments/gsdi/drift-u-kt-on">
	    <input>/instrumentation/gsdi/drift-u-kt</input>
            <input>instruments/gsdi/drift-u-kt-mute</input>
        </summer>
	
	<summer name="instruments/gsdi/drift-v-kt-on">
	    <input>/instrumentation/gsdi/drift-v-kt</input>
            <input>instruments/gsdi/drift-v-kt-mute</input>
        </summer>
	
	<switch name="instruments/gsdi/drift-u-kt">
            <default value="instruments/gsdi/drift-u-kt-on"/>
            <test  logic="AND" value="instruments/gsdi/drift-u-kt-mute">
                instruments/gsdi/drift-u-kt-mute gt 1
                electrical/outputs/instr-ignition-switch  lt 27
            </test>
        </switch>

        <switch name="instruments/gsdi/drift-v-kt">
            <default value="instruments/gsdi/drift-v-kt-on"/>
	    <test  logic="AND" value="instruments/gsdi/drift-v-kt-mute">
                instruments/gsdi/drift-v-kt-mute gt 1
                electrical/outputs/instr-ignition-switch  lt 27
            </test>
        </switch>


    </channel>

    <channel name="TACAN">



   </channel>
   
   
   <channel name="AFCS-switch">
       
       
    <switch name="ap/afcs/channels-active-norm">
         <default value="0"/>
         <test logic="AND" value="1">
                instruments/autopilot-AFCS  == 1
         </test>         
	<output>ap/afcs/roll-channel-active-norm</output>
	<output> ap/afcs/pitch-channel-active-norm</output>
	<output>ap/afcs/yaw-channel-active-norm</output>
	<output>ap/afcs/altitude-channel-active-norm</output>
     </switch>  



   </channel>




</system>
